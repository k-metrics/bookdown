# はじめに {.unnumbered}
ソフトウェア開発において「データに基づく品質管理」が必要と言われるようになってから久しくなりますが、様々な理由でデータに基づく管理を実践している組織はまだまだ少数派ではないでしょうか？しかし、世の中の流れは「データドリブン」というキーワードに代表されるようにデータを使いこなせる組織が優位に立てる時代、数学が利益を生み出す数理資本主義の時代と言われています。

[[『データ指向のソフトウェア品質マネジメント』]](https://www.juse-p.co.jp/products/view/442) は、日本のソフトウェア品質管理におけるデータ管理の必要性とデータ分析に必要な知識を解説している数少ない書籍です。この書籍の著者の一人である小池氏が主催している [[データ分析勉強会]](https://sites.google.com/site/kantometrics/home) では、メトリクス分析に興味をもつ有志が統計分析を実践するために統計的コンピューティングを中心に様々な知識や手法を学んでいます。

本書は実務でメトリクス分析を行いたいソフトウェア品質技術者をはじめとした統計的コンピューティングに興味を持っている方々に [[R言語]](https://www.r-project.org/) の基本的な知識を紹介しています。データ分析勉強会を通じて学んだ分析手法を実務で実践したい方の一助になれば幸いです。


## 想定読者 {.unnumbered}
本書は統計的コンピューティングに興味があり基本的なコンピュータの知識と基礎的な統計の知識を有している方々を読者として想定しています。本書では [[R言語]](https://cran.r-project.org/) を実行するための環境構築に関する詳細な解説は行いませんの「で、R言語のインストール手順などは市販の書籍やインターネットの情報を参考にしてください。なお、環境構築に不安があるけれどもとりあえずR言語を使ってみたいという方には [[Google Colaboratory]](`https://colab.research.google.com/notebook#create=true&language=r`) の利用をおすゝめします。


## 表記ルール {.unnumbered}
本書では以下の表記ルールを用いています。

対象                     | 表記方法                             | 表記例
-------------------------|--------------------------------------|--------------
ハイパーリンク           | []付きで表記                         | [[Google]](https://www.google.com/?hl=ja)
パス名、ファイル名       | モノフォント（タイプライタフォント） | `sample/sample.Rmd`
パッケージ名             | 太字のモノフォント                   | **`tidyverse`**
関数（オブジェクト）     | モノフォントで()付き表記             | `print()`
コード                   | モノフォント（プロンプトなし）       | `library(tidyverse)`
コードの実行結果         | モノフォント（`##` プロンプトあり）  | `## output...`

\newpage

## なぜ R を使うのか {.unnumbered}
データ分析を行うためには適切な分析ツールが必要不可欠です。[[R言語]](https://www.r-project.org/) は統計分析に特化しているオープンソースの言語でデータ分析に最適なツールのひとつです。R がデータ分析に向いている理由をまとめているのが [["Six Reasons To Learn R For Business", R Blogger]](https://www.r-bloggers.com/six-reasons-to-learn-r-for-business/) です。

> 1.  R Has The Best **Overall Qualities**
> 2.  R Is Data Science **For Non-Computer Scientists**
> 3.  Learning R Is **Easy With The Tidyverse**
> 4.  R Has **Brains, Muscle, And Heart**
> 5.  R Is Built **For Business**
> 6.  R **Community** Support

R はデータ分析に必要となるデータのハンドリングや可視化、モデリング、そして、レポーティングといった様々な機能を無料で利用することができます。また、R は逐次実行のインタプリタ型言語ですのでソフトウェアメトリクス分析のような探索的分析（Exploratory data analysis）に適していると言えます。さらに、非常にフレンドリーかつ活発なコミュニティーが日本でも形成されていますので、悩んだ時などに気軽に質問・相談ができるのも大きな強みです。


## 分析の手順 {.unnumbered}
では、R を使った分析とはどのような手順になるかを簡単に見てみましょう。R は分析のための単なるツールですので、データ分析の常套手段してはツールに関係なく最初に分析対象となるデータがどのような分布なのか、どのような値の範囲にあるのか、全てのデータが揃っているかなどを俯瞰することからはじめます。
例えば「フィッシャーのあやめ（Fisher's or Anderson's iris）」を例にとってみましょう。「フィッシャーのあやめ」はRの例題でよく使われる下記のような150行のデータセットでRに標準で組み込まれています。

```{r, echo=FALSE}
iris %>% 
  psych::headTail()
```

このデータセットの主な要約統計量は以下のようになり、Sepal（萼片）よりPetal（花弁）の方が小さい傾向にあると推測できます。
```{r, echo=FALSE}
summary(iris)
```

この要約の通りか箱ひげ図を描いて確かめてみますが、このままの形では都合が悪いので下記のように変形しておきます。
```{r, echo=FALSE}
iris %>%
  tidyr::pivot_longer(cols = -Species, names_to = "part", values_to = "value") %>% 
  psych::headTail()
```

変形したデータを使って部位別の箱ひげ図を描くと確かに Petal（花弁）の方が Sepal（萼片）よりも小さい傾向にあることが分かります。
```{r, echo=FALSE, out.width="90%"}
iris %>%
  tidyr::pivot_longer(cols = -Species, names_to = "part", values_to = "value") %>% 
  ggplot2::ggplot(ggplot2::aes(x = part, y = value)) + 
   ggplot2::geom_boxplot()
```



これがデータサイエンスワークフロー（Data Science Workflow）と呼ばれる分析フローです。

\newpage

## Data Science Workflow {.unnumbered}

データ分析の方法は様々ですが、そのプロセスは下図のように抽象化することができます。

<!-- ```{r, echo=FALSE, out.width="95%", fig.cap="Data Science Workflow, CC BY-NC-ND 3.0 US, Hadley Wickham"}
-->

```{r, echo=FALSE, out.width="95%", fig.cap="Data Science Workflow, CC BY-NC-ND 3.0 US, Hadley Wickham"}
# knitr::include_graphics("https://raw.githubusercontent.com/hadley/r4ds/master/diagrams/data-science-explore.png")
knitr::include_graphics("fig/data-science.png")
```

<!-- <p align=right>図出典：[RStartHere, RStudio, inc. <i class="fa fa-external-link"></i>](https://github.com/rstudio/RStartHere){target="_blank"}</p> -->

この図は「Data Science Workflow」と呼ばれ、R コミュニティに多大な貢献をしている Hadley Wickham がその著書 [『R for Data Science』 <i class="fa fa-external-link"></i>](https://r4ds.had.co.nz/){target="_blank"} で提唱している概念図です。本書は、この Data Science Workflow に基づくページ構成になっており各プロセスのスコープ概略は下記の通りです。\
　

**Program**\
データ分析のすべてのプロセス（Tidy 〜 Communicate/Automate）で必要となるツールがプログラミングです。プログラミングを覚えることで効率的に分析処理を行えるようになります。

**Import**\
分析対象となるデータを分析環境に取り込み分析をできるようにするのがインポートプロセスです。データは様々な形式（文字コード、ファイル形式など）で保存されていますので、それらに見合った方法でインポートする必要があります。\
　\
**Tidy**\
インポートしたデータは必ずしもデータ分析に適した形式になっているとは限りませんので、一貫した形式（Tidy data）に整理します。 [Tidy data <i class="fa fa-external-link"></i>](){target="_blank"} はデータ分析において重要な概念です。\
　\
**Transform**\
整理したデータ（Tidy data）がそのまま状態でデータ分析に使えることは稀です。不要なデータを削除したり（クレンジング）、必要なデータだけに絞り込んだり、新しい変数を計算したりする必要があります。\
　**Tidy** プロセスと合わせて **Wrangle** や **Data wrangling**、前処理と呼ばれることもあります。\
　\
**Visualize**\
データを可視化することは様々な示唆を得ることと同義といえます。分析方針を考えるためにもデータがどういう傾向をもっているのかを把握するためのプロセスともいえます。\
　\
**Model**\
可視化で得られた情報を元に数式可（モデル化）するのプロセスです。モデルは様々な\
　\
**Communicate**\
分析結果を他人に伝えるためのプロセスです。結果を他人に伝えるだけでは不十分で [再現可能性（Reproducible research） <i class="fa fa-external-link"></i>](){target="_blank"} が伴っていることも求められます。 　 　[3つの再現可能性 <i class="fa fa-external-link"></i>](http://www.igaku-shoin.co.jp/paperDetail.do?id=PA03357_03){target="_blank"}

## Tidyverse Eco System {.unnumbered}

　このような Data Science Workflow を R で実現するための手段が Hadley Wickham により開発された tidyverse パッケージ群による Tidyverse Eco System です。tidyverse
