---
title: "Rのすゝめ"
author: "Sampo Suzuki, CC 4.0 BY-NC-SA"
date: "`r format(Sys.Date(), format = '%Y-%m-%d')`"
output: pdf_document
description: 本書はデータ分析勉強会で学んだ成果をまとめたものです
site: bookdown::bookdown_site
github-repo: k-metrics/bookdown
always_allow_html: yes
bibliography:
- bib/references.bib
- bib/packages.bib
link-citations: yes
colorlinks: yes
lot: yes
lof: yes
fig_crop: no
fontsize: 12pt
linestretch: 1.1
links-as-notes: yes
mainfontoptions: Scale=MatchUppercase
monofontoptions: Scale=0.8
CJKoptions: Scale=1.0
subtitle: 〜 Rによるデータ分析事始め 〜
# https://github.com/chdemko/pandoc-latex-environment/
# header-includes:
# - |
#   ```{=latex}
#   \usepackage{tcolorbox}
# 
#   \newtcolorbox{info-box}{colback=cyan!5!white,arc=0pt,outer arc=0pt,colframe=cyan!60!black}
#   \newtcolorbox{warning-box}{colback=orange!5!white,arc=0pt,outer arc=0pt,colframe=orange!80!black}
#   \newtcolorbox{error-box}{colback=red!5!white,arc=0pt,outer arc=0pt,colframe=red!75!black}
#   ```
# pandoc-latex-environment:
#   tcolorbox: [box]
#   info-box: [info]
#   warning-box: [warning]
#   error-box: [error]
---

```{css, include=FALSE}
# local CSS for gitbook
```

```{r setup, include=FALSE}
require(tidyverse)
require(psych)
require(e1071)
require(modeest)

knitr::opts_chunk$set(echo = TRUE,                 # Rコードを出力する
                      warning = FALSE,             # Rの警告を抑止する
                      fig_caption = TRUE,
                      fig.align = 'center',        # 図を中央揃えにする
                      attr.source='.numberLines',  # Rコードに行番号表示
                      out.width = "90%"            # 画像幅のデフォルト
                      )

# 出力がPDF(LaTeX)の場合の追加設定
if (knitr::is_latex_output()) {
    knitr::opts_chunk$set(dev = "cairo_pdf",       # 図の出力にPDFデバイスを使う
                          # dev.args = list(family = "Noto Serif"),
                          dev.args = list(family = "Source Han Code JP"),
                                                   # 図のフォントを指定する
                          fig.pos = "H",           # 図をその場で表示させる
                          out.extra = "",
                          tinytex.verbose = TRUE   # デバッグ用メッセージを出力
                          )
# ePUB形式の場合の追加設定
} else if (!knitr::is_html_output(excludes = "epub")) {
    knitr::opts_chunk$set(dev = "jpeg")            # 図の出力にJPEGデバイスを使う
}

# 図の描画位置調整については以下を参照
# https://gedevan-aleksizde.github.io/rmarkdown-cookbook/figure-placement.html#force-floats-forward
# opts_chunkで"fig.pos"を指定することで全てのチャンク出力に対して調整可能
# h: フロートをここ (here) に配置します. つまりソーステキスト上に現れるところとほぼ同じ位置です.
# t: そのページの先頭 (top) に配置します.
# b: そのページの末尾 (bottom) に配置します.
# p: フロート専用の特別なページに配置します.
# !: LaTex が「良い」フロートの位置を決定するための内部パラメータ上書きします.
# H: フロートを正確に LaTex コード上と同じ位置に配置します. float パッケージが必要です (\usepackage{float}).

htmltools::tagList(rmarkdown::html_dependency_font_awesome())

# Update packages.bib file
tidyverse::tidyverse_packages() %>% 
  c(., tidymodels::tidymodels_packages(), "knitr", "rmarkdown","bookdown",
    "DBI", "zoo", "htmlwidgets", "shiny", "modeest", "patchwork", "Rcmdr") %>% 
  sort() %>% unique() %>% 
  knitr::write_bib("./bib/packages.bib")

## 出力によりテーブル表記を変更する
# HTML format use rmarkdown::paged_table
# PDF/DOCX format use kableExtra package
#  https://haozhu233.github.io/kableExtra/
#  https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf
# WARNING:
# Should NOT exec df_print befor skimr::skim (has bug) 
# Do NOT require() or library() kableExtra package with using skimr package
df_print <- function(df = NULL,             # 表示させたいデータをフレームを指定
                     n = 3L,                # 省略表示時の行数
                     caption = NULL,        # 表見出しを指定
                     booktabs = TRUE,       # FALSEで縦罫線を描画
                     font_size = NULL,      # 表内文字のフォントサイズ
                     position = "center",   # 表の横位置
                     full_width = FALSE,    # TRUEで幅いっぱいに拡大表示
                     scale_down = FALSE,    # TRUEで横幅に収まるよう縮小表示
                     all = FALSE,           # TRUEですべてのデータを表示
                     head_tail = FALSE,     # TRUEで先頭・末尾をn行ずつ表示
                     ...) {                 # kableExtra::kblに渡す引数
  if (!is.null(df)) {
    if (knitr::is_latex_output()) {
      if (scale_down == FALSE) {
        # latex_option = c("striped", "HOLD_position")
        latex_option = c("striped", "HOLD_position")
      } else {
        # latex_option = c("striped", "HOLD_position", "scale_down")
        latex_option = c("striped", "HOLD_position", "scale_down")
      }
      if (all == FALSE) {
        df <- df %>% 
          psych::headTail(top = n,
                          bottom = dplyr::if_else(head_tail == FALSE, 0L, n))
      }
      df %>% 
        kableExtra::kbl(caption  = caption, booktabs = booktabs, ...) %>%
        kableExtra::kable_styling(font_size = font_size, position = position,
                                  full_width = full_width,
                                  latex_options = latex_option)
    } else {   # 出力タイプ不明の場合
      df %>% 
        rmarkdown::paged_table()
    }
  }
}

# 演習の番号に使う変数
eqn <- 1
```


# License {.unnumbered}

-------------------------------------------------------------------------------

　本書は[クリエイティブ・コモンズ 表示 - 非営利 - 継承 4.0 国際 ライセンス](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja){target="_blank" title="Creative Commons"}の下に提供されています。あなたは以下の条件に従う限り自由に共有・翻案することができます。

　あなたの従うべき条件は以下の通りです。  
　  

::: {.warning-box data-latex=""}
-   表示（BY）

    -   あなたは 適切なクレジットを表示し、ライセンスへのリンクを提供し、変更があったらその旨を示さなければなりません。これらは合理的であればどのような方法で行っても構いませんが、許諾者があなたやあなたの利用行為を支持していると示唆するような方法は除きます。

-   非営利（NC）

    -   あなたは営利目的でこの資料を利用してはなりません。

-   継承（SA）

    -   もしあなたがこの資料をリミックスしたり、改変したり、加工した場合には、あなたはあなたの貢献部分を元の作品と同じライセンスの下に頒布しなければなりません。
:::

<!-- PDF出力において下記の一行は"out.width"オプションを使う場合には呪文として必須。この一行が無いとknitrパッケージに"out.width"オプション指定時に図の格納先を見失うバグが残ってる模様。詳細は下記URLにて
https://stackoverflow.com/questions/40470290/r-markdown-pdf-output-figure-with-out-width-90-generating-the-wrong-path-with
https://github.com/rstudio/rmarkdown/issues/2024
-->
<!-- ![CC 4.0 BY-NC-SA]("./fig/by-nc-sa.png") -->

`r if (knitr::is_latex_output()) '
![CC 4.0 BY-NC-SA]("./fig/by-nc-sa.png")
'`

```{r, echo=FALSE, out.width="20%", eval=knitr::is_html_output()}
if (knitr::is_html_output(excludes = c("epub"))) {
  knitr::include_graphics("./fig/by-nc-sa.png")
}
```

　ただし、本書にて引用している文書、図、ロゴなどの権利は原著作者が保有しています。

<!-- ------------------------------------------------------------------------------- -->
