---
title: "Rのすゝめ"
subtitle: "- Rによるデータ分析事始め -"
author: "Sampo Suzuki, CC 4.0 BY-NC-SA"
date: "`r format(Sys.Date(), format = '%Y-%m-%d')`"
description: "本書はデータ分析勉強会で学んだ成果をまとめたものです"
site: bookdown::bookdown_site
github-repo: k-metrics/bookdown
# LaTeX関連の設定はベースとなるRmdに記述しないと正しく認識されません
always_allow_html: true  # 一種の呪文
bibliography: [./bib/references.bib, ./bib/packages.bib]
colorlinks: true         # ハイパーリンクを色分けする
# documentclass: krantz
fig_crop: false
fontsize: 12pt           # 本文のフォントサイズ
highlight: default       # tango pygments kate haddoc
linestretch: 1.1        # 行間の指定
links-as-notes: true     # ハイパーリンク先を脚注に記載
## 日本語とtufte, kableExtraを使うために必要なTeXパッケージ群
# A4 210mm x 297mm
#  \usepackage[a4paper, total={6.5in, 9.5in}]{geometry}
#  \usepackage[pdfbox,tombo]{gentombow}
#  \usepackage{indentfirst}   # tinytexのリポジトリには存在しない
header-includes: |
  \usepackage[a4paper, total={160mm, 247mm}, left=25mm, top=25mm]{geometry}
  \usepackage{booktabs}
  \usepackage{longtable}
  \usepackage{array}
  \usepackage{multirow}
  \usepackage{wrapfig}
  \usepackage{float}
  \usepackage{colortbl}
  \usepackage{pdflscape}
  \usepackage{tabu}
  \usepackage{threeparttable}
  \usepackage{threeparttablex}
  \usepackage[normalem]{ulem}
  \usepackage{inputenc}
  \usepackage{makecell}
  \usepackage{xcolor}
  \usepackage{amsmath}
  \usepackage{fontawesome5}
  \usepackage{subfig}
  \usepackage{xeCJK}
  \usepackage[noto]{zxjafont}
  \usepackage{zxjatype}
## Windows環境では上記の設定ではNotoフォントが認識されないので以下の行と
## 入れ替えてIPAフォントを利用するのが楽
# \usepackage[ipaex]{zxjafont}
## モノフォントのみ入れ替えフォントのスケーリングを調整する
mainfontoptions: "Scale=MatchUppercase"
monofont: "Source Han Code JP"
monofontoptions: "Scale=0.8"
# monofontoptions: "Scale=0.96"
CJKoptions: "Scale=1.0"
## Windows環境でNotoフォントを指定したい場合は以下のように個別に指定する
## 必要があるが、以下だけでは太字が表示できないので追記が必要（調査中）
# mainfont: NotoSerifCJKjp-Regular.otf
# mainfontoptions: Scale=MatchUppercase
# sansfont: NotoSansCJKjp-Regular.otf
# monofont: NotoSansMonoCJKjp-Regular.otf
# # mathfont: Noto Serif CJK JP
# CJKmainfont: NotoSerifCJKjp-Regular.otf
# CJKmonofont: NotoSansMonoCJKjp-Regular.otf
# CJKsansfont: NotoSansCJKjp-Regular.otf
# CJKoptions: Scale=1
---


```{css, include=FALSE}
# local CSS for gitbook
```

```{r setup, include=FALSE}
require(tidyverse)

# 図の描画位置調整については以下を参照
# https://gedevan-aleksizde.github.io/rmarkdown-cookbook/figure-placement.html#force-floats-forward
# opts_chunkで"fig.pos"を指定することで全てのチャンク出力に対して調整可能
# h: フロートをここ (here) に配置します. つまりソーステキスト上に現れるところとほぼ同じ位置です.
# t: そのページの先頭 (top) に配置します.
# b: そのページの末尾 (bottom) に配置します.
# p: フロート専用の特別なページに配置します.
# !: LaTex が「良い」フロートの位置を決定するための内部パラメータ上書きします.
# H: フロートを正確に LaTex コード上と同じ位置に配置します. float パッケージが必要です (\usepackage{float}).

knitr::opts_chunk$set(echo = TRUE, fig_caption = TRUE, fig.align = 'center',
                      warning = FALSE, fig.pos = "H", out.extra = "",
                      out.width = "85%")

htmltools::tagList(rmarkdown::html_dependency_font_awesome())

output <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if (!is.null(output)) {
  if (output == "latex") {
    knitr::opts_chunk$set(dev = "cairo_pdf",
                          dev.args = list(family = "Noto Serif"))
  }
}

# Update packages.bib file
tidyverse::tidyverse_packages() %>% 
  c(., tidymodels::tidymodels_packages(), "knitr", "rmarkdown","bookdown",
    "DBI", "zoo", "htmlwidgets", "shiny", "modeest", "patchwork", "Rcmdr") %>% 
  sort() %>% unique() %>% 
  knitr::write_bib("./bib/packages.bib")

## 出力によりテーブル表記を変更する
# HTML format use rmarkdown::paged_table
# PDF/DOCX format use kableExtra package
#  https://haozhu233.github.io/kableExtra/
#  https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf
# WARNING:
# Should NOT exec df_print befor skimr::skim (has bug) 
# Do NOT require() or library() kableExtra package with using skimr package
df_print <- function(df = NULL, n = 3L, caption = NULL, scale_down = FALSE,
                     font_size = NULL, position = "center", full_width = FALSE,
                     ...) {
  if (!is.null(df)) {
    if (knitr::is_html_output(excludes = c("epub"))) {
      rmarkdown::paged_table(df)
    } else if (knitr::is_latex_output()) {
      if (scale_down == FALSE) {
        latex_option = c("striped", "HOLD_position")
      } else {
        latex_option = c("striped", "HOLD_position", "scale_down")
      }
      df %>% 
        psych::headTail(top = n, bottom = n) %>% 
        kableExtra::kbl(caption  = caption, ...) %>%
        kableExtra::kable_styling(font_size = font_size, position = position,
                                  full_width = full_width,
                                  latex_options = latex_option)
    } else {  # ePUBの場合
      df %>% 
        psych::headTail(top = n, bottom = n) %>% 
        kableExtra::kbl(caption  = caption, ...)
    }
  }　else {
    return(NULL)
  }
}

```

# License {.unnumbered}

-------------------------------------------------------------------------------

　本書は[クリエイティブ・コモンズ 表示 - 非営利 - 継承 4.0 国際 ライセンス](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja){target="_blank" title="Creative Commons"}の下に提供されています。あなたは以下の条件に従う限り自由に共有・翻案することができます。

　あなたの従うべき条件は以下の通りです。

-   表示（BY）

    -   あなたは 適切なクレジットを表示し、ライセンスへのリンクを提供し、変更があったらその旨を示さなければなりません。これらは合理的であればどのような方法で行っても構いませんが、許諾者があなたやあなたの利用行為を支持していると示唆するような方法は除きます。

-   非営利（NC）

    -   あなたは営利目的でこの資料を利用してはなりません。

-   継承（SA）

    -   もしあなたがこの資料をリミックスしたり、改変したり、加工した場合には、あなたはあなたの貢献部分を元の作品と同じライセンスの下に頒布しなければなりません。

<!-- PDF出力において下記の一行は"out.width"オプションを使う場合には呪文として必須。この一行が無いとknitrパッケージに"out.width"オプション指定時に図の格納先を見失うバグが残ってる模様。詳細は下記URLにて
https://stackoverflow.com/questions/40470290/r-markdown-pdf-output-figure-with-out-width-90-generating-the-wrong-path-with
https://github.com/rstudio/rmarkdown/issues/2024
-->
<!-- ![CC 4.0 BY-NC-SA]("./fig/by-nc-sa.png") -->

`r if (knitr::is_latex_output()) '
![CC 4.0 BY-NC-SA]("./fig/by-nc-sa.png")
'`

```{r, echo=FALSE, out.width="20%", eval=knitr::is_html_output()}
if (knitr::is_html_output(excludes = c("epub"))) {
  knitr::include_graphics("./fig/by-nc-sa.png")
}
```

　ただし、本書にて引用している文書、図、ロゴなどの権利は原著作者が保有しています。

-------------------------------------------------------------------------------

